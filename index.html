<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ARAFAT COMPUTER – Receipt</title>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    :root{
      --brand:#ff3b30; --brand2:#0066ff; --ink:#0e1726; --muted:#5b6b7a; --paper:#ffffff;
      --chip:#eef6ff; --chip2:#ffeef0;
    }
    html,body{height:100%; background:linear-gradient(180deg,#f3f7ff, #fff);}
    body{font-family:"Noto Sans", Inter, sans-serif; color:var(--ink); margin:0;}
    .app{max-width:980px; margin:24px auto; padding:16px;}
    .toolbar{display:flex; gap:10px; justify-content:flex-end; margin-bottom:12px;}
    .btn{border:none; cursor:pointer; padding:10px 14px; border-radius:12px; font-weight:700; box-shadow:0 6px 18px rgba(0,0,0,.06);}
    .btn-primary{background:var(--brand2); color:white;}
    .btn-outline{background:#fff; color:var(--brand2); border:2px solid var(--brand2);}
    .btn-add{background:#28a745; color:white;}
    .btn-clear{background:#ff3b30; color:white;}
    .sheet{width:210mm; min-height:297mm; background:var(--paper); box-shadow:0 10px 26px rgba(0,0,0,.12); margin:0 auto; position:relative;}
    .sheet::before{content:"ARAFAT COMPUTER"; position:absolute; top:50%; left:50%; transform:translate(-50%,-50%) rotate(-30deg); font-size:72px; font-weight:900; color:#add8e6; opacity:0.15; white-space:nowrap; pointer-events:none;}
    .sheet-inner{padding:16mm 14mm 12mm 14mm;}
    .brand{display:flex; align-items:center; gap:16px; border-bottom:4px solid var(--chip); padding-bottom:10px;}
    .brand-title{font-weight:900; font-size:34px;}
    .brand-title .a{color:var(--brand);}
    .brand-title .b{color:var(--ink);}
    .tagline{font-size:13px; color:var(--muted);}
    .contact{font-size:13px; color:#0b5; font-weight:700}
    .meta{display:grid; grid-template-columns:1fr 1fr; gap:10px; margin-top:10px}
    .meta .field{display:flex; gap:10px; align-items:center; background:linear-gradient(90deg,var(--chip),transparent); padding:8px 10px; border-radius:10px;}
    .meta label{min-width:70px; font-weight:700; color:var(--muted)}
    .meta input, .meta textarea{flex:1; border:none; outline:none; padding:8px 10px; border-radius:8px; background:#fff; box-shadow:inset 0 0 0 2px #e5edf7}
    .meta textarea{height:44px;}
    table{width:100%; border-collapse:separate; border-spacing:0; margin-top:14px; font-size:14px}
    thead th{background:#eaf3ff; color:#103; text-align:left; padding:10px; border:1px solid #d9e7ff;}
    tbody td{padding:8px 10px; border:1px solid #edf3fb;}
    input.cell{width:100%; border:none; outline:none; background:transparent; padding:6px; box-shadow:inset 0 -1px 0 0 #e9eef6}
    input.cell.center{text-align:center}
    input.cell.right{text-align:right}
    .totals{margin-top:8px; margin-left:auto; width:320px}
    .totals .row{display:grid; grid-template-columns:1fr 120px; align-items:center; gap:10px; margin:4px 0}
    .totals .row label{font-weight:800; color:#123}
    .totals .row input{border:none; outline:none; background:#f6f9ff; padding:8px 10px; border-radius:10px; text-align:right; box-shadow:inset 0 0 0 2px #e0e9fb}
    .inwords{margin-top:14px; background:#f6fbff; border:2px dashed #d5e8ff; padding:10px 12px; border-radius:14px;}
    .inwords label{font-weight:800; color:var(--brand2)}
    .signs{display:grid; grid-template-columns:1fr 1fr; gap:16px; margin-top:60px}
    .sign{border-top:2px solid #cfe0ff; padding-top:8px; text-align:center; color:#334}
    .qrcode-wrap{margin-top:10px; display:flex; justify-content:flex-start;}
    .qrcode-wrap img{width:100px; height:100px; border:1px solid #e2eefc; background:white; padding:6px; border-radius:8px}
    @media print{ body{background:white} .app{margin:0; padding:0} .toolbar{display:none} .sheet{box-shadow:none; margin:0} }
  </style>
</head>
<body>
<div class="app">
  <div class="toolbar">
    <button class="btn btn-add" id="addRowBtn">➕ Add Row</button>
    <button class="btn btn-clear" id="clearBtn">Clear Form</button>
    <button class="btn btn-outline" id="downloadBtn">PDF Download</button>
    <button class="btn btn-primary" id="printBtn">Print</button>
  </div>
  <div class="sheet" id="receipt">
    <div class="sheet-inner">
      <header class="brand">
        <div>
          <div class="brand-title"><span class="a">ARAFAT</span> <span class="b">TRAVELS & COMPUTER</span></div>
          <div class="tagline">Samiha Street Al Wazarat, Saudi Arabia · All Kind of Online Work, Air Ticket, Insurance, Photocopy Etc.</div>
          <div class="contact">Mobile: 0504494641 / 0505782441</div>
        </div>
      </header>

      <section class="meta">
        <div class="field"><label>Name</label><input id="custName" placeholder="Enter name"></div>
        <div class="field"><label>Date</label><input type="text" id="date" placeholder="dd/mm/yyyy"></div>
        <div class="field" style="grid-column:1 / span 2"><label>Address</label><textarea id="address" placeholder="Enter address"></textarea></div>
      </section>

      <table>
        <thead>
          <tr>
            <th style="width:70px">SL. NO</th>
            <th>Description</th>
            <th style="width:100px">Quantity</th>
            <th style="width:120px">Unit Price</th>
            <th style="width:140px">Amount</th>
          </tr>
        </thead>
        <tbody id="rows"></tbody>
      </table>

      <div class="totals">
        <div class="row"><label>Total</label><input id="total" value="0" readonly></div>
        <div class="row"><label>Advance</label><input id="advance" value="0"></div>
        <div class="row"><label>Due</label><input id="due" value="0" readonly></div>
        <div class="row"><label>Grand Total</label><input id="grandTotal" value="0" readonly></div>
      </div>

      <div class="qrcode-wrap"><img id="qrcodeImg" alt="QR Code" src=""/></div>

      <div class="inwords"><label>In words:</label>
        <span id="inWordBn" style="font-weight:700; margin-left:6px">Zero Riyal</span>
      </div>

      <div class="signs">
        <div class="sign">Customer Signature</div>
        <div class="sign">Manager Signature</div>
      </div>
    </div>
  </div>
</div>

<!-- libs -->
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.1/build/qrcode.min.js"></script>
<script>
const ones = ["","one","two","three","four","five","six","seven","eight","nine","ten","eleven","twelve","thirteen","fourteen","fifteen","sixteen","seventeen","eighteen","nineteen"];
const tens = ["","",'twenty','thirty','forty','fifty','sixty','seventy','eighty','ninety'];

function twoDigitsToEn(n){ if(n<20) return ones[n]; const t=Math.floor(n/10), o=n%10; return o? tens[t] + " " + ones[o] : tens[t]; }
function numberToEnglishWords(num){
  num=Number(num); if(!isFinite(num)) return "";
  if(num===0) return "Zero Riyal";
  const whole=Math.floor(num); const paisa=Math.round((num-whole)*100);
  function chunk(n){ const parts=[];
    const crore=Math.floor(n/10000000); n%=10000000; if(crore) parts.push(twoDigitsToEn(crore)+" crore");
    const lakh=Math.floor(n/100000); n%=100000; if(lakh) parts.push(twoDigitsToEn(lakh)+" lakh");
    const thousand=Math.floor(n/1000); n%=1000; if(thousand) parts.push(twoDigitsToEn(thousand)+" thousand");
    const hundred=Math.floor(n/100); n%=100; if(hundred) parts.push(ones[hundred]+" hundred");
    if(n) parts.push(twoDigitsToEn(n)); return parts.join(" ");
  }
  let out = chunk(whole) + " Riyal";
  if(paisa) out += " " + twoDigitsToEn(paisa) + " halala";
  return out;
}

const rowsEl = document.getElementById('rows');
let rowCount = 0;
function addRow(){
  rowCount++;
  const tr = document.createElement('tr');
  tr.innerHTML = `
    <td><input class="cell center" value="${rowCount}" readonly></td>
    <td><input class="cell" placeholder="Description"></td>
    <td><input class="cell right qty" type="number" step="1" placeholder="0"></td>
    <td><input class="cell right unit" type="number" step="0.01" placeholder="0.00"></td>
    <td><input class="cell right amount" type="number" step="0.01" placeholder="0.00" readonly></td>
  `;
  rowsEl.appendChild(tr);
  tr.querySelectorAll('input').forEach(i=> i.addEventListener('input',recalc));
}
addRow();

function recalc(){
  let total=0;
  document.querySelectorAll('#rows tr').forEach(row=>{
    const qty = Number(row.querySelector('.qty')?.value || 0);
    const unit = Number(row.querySelector('.unit')?.value || 0);
    const amt = qty * unit;
    row.querySelector('.amount').value = amt.toFixed(2);
    total += amt;
  });
  document.getElementById('total').value = total.toFixed(2);

  const adv = Number(document.getElementById('advance').value||0);
  const due = Math.max(total-adv,0);
  document.getElementById('due').value = due.toFixed(2);

  document.getElementById('grandTotal').value = total.toFixed(2);
  document.getElementById('inWordBn').textContent = numberToEnglishWords(total);
  generateQRCode();
}

document.getElementById('advance').addEventListener('input',recalc);
document.getElementById('addRowBtn').addEventListener('click', addRow);
document.getElementById('clearBtn').addEventListener('click', ()=>{
  rowCount=0; rowsEl.innerHTML=''; addRow();
  document.getElementById('custName').value='';
  document.getElementById('address').value='';
  document.getElementById('advance').value='0';
  document.getElementById('inWordBn').textContent='Zero Riyal';
  document.getElementById('qrcodeImg').src='';
  recalc();
});

// default today date
(function setDefaultDate(){
  const today=new Date();
  const dd=String(today.getDate()).padStart(2,'0');
  const mm=String(today.getMonth()+1).padStart(2,'0');
  const yyyy=today.getFullYear();
  document.getElementById('date').value = `${dd}/${mm}/${yyyy}`;
})();

// QR code
async function generateQRCode(){
  try{
    const payload = {
      name: document.getElementById('custName').value || '',
      address: document.getElementById('address').value || '',
      date: document.getElementById('date').value || '',
      total: document.getElementById('total').value || '0',
      due: document.getElementById('due').value || '0',
      grandTotal: document.getElementById('grandTotal').value || '0',
      timestamp: new Date().toISOString()
    };
    const text = JSON.stringify(payload);
    const dataUrl = await QRCode.toDataURL(text, { width: 300, margin:1 });
    document.getElementById('qrcodeImg').src = dataUrl;
  }catch(e){ console.error('QR error', e); }
}
generateQRCode();

// Print & PDF
document.getElementById('printBtn').addEventListener('click', async ()=>{
  await generateQRCode(); window.print();
});
document.getElementById('downloadBtn').addEventListener('click', async ()=>{
  await generateQRCode();
  const el = document.getElementById('receipt');
  const canvas = await html2canvas(el, { scale: 3, useCORS: true });
  const imgData = canvas.toDataURL('image/png');
  const pdf = new jspdf.jsPDF('p','mm','a4');
  const pdfWidth = 210;
  const pdfHeight = (canvas.height * pdfWidth) / canvas.width;
  pdf.addImage(imgData, 'PNG', 0, 0, pdfWidth, pdfHeight);
  pdf.save('receipt.pdf');
});

// auto recalc
rowsEl.addEventListener('input', ()=>{ recalc(); generateQRCode(); });
</script>
</body>
</html>
